!function(){"use strict";const t=new Map([["\t","\\t"],["\r","\\r"],["\n","\\n"],["\v","\\v"],["\f","\\f"],["\\","\\\\"],["-","\\-"],[".","\\."],["(","\\("],[")","\\)"],["[","\\["],["]","\\]"],["{","\\{"],["}","\\}"],["|","\\|"],["^","\\^"],["$","\\$"],["?","\\?"],["+","\\+"],["*","\\*"]]),e=e=>t.get(e)??`\\u${e.charCodeAt(0).toString(16).padStart(4,"0")}`,s=(t,s)=>s.replace(t,e),r=s.bind(null,/[^-a-zA-Z0-9 ,:;'"!@%&_=<>`~]/g),n=s.bind(null,/[^a-zA-Z0-9 ,:;'"!@%&_=<>`~(){}.?+*$]/g),i=t=>{let e=0,s=-2;const r=[];for(let i=0;i<=t.length;++i){const h=i===t.length?-2:t[i].charCodeAt(0);if(h!==s+1){const s=i-e;e=i,s>1&&(3===s?r.push(n(t[i-2])):s>3&&r.push("-"),r.push(n(t[i-1]))),i<t.length&&r.push(n(t[i]))}s=h}return r.join("")};class h{constructor(t,e=!1){this.chars=t,this.inverted=e}includes(t){return-1!==this.chars.indexOf(t)!==this.inverted}isEmpty(){return!this.chars.length&&!this.inverted}isSingular(){return 1===this.chars.length&&!this.inverted}singularChar(){if(!this.isSingular())throw new Error("Not singular");return this.chars[0]}equals(t){if(this===t)return!0;if(this.inverted!==t.inverted||this.chars.length!==t.chars.length)return!1;this.chars.sort(),t.chars.sort();for(let e=0;e<this.chars.length;++e)if(this.chars[e]!==t.chars[e])return!1;return!0}intersects(t){return!!(this===t||this.inverted&&t.inverted)||(this.inverted?this.chars.length?t.chars.some((t=>this.includes(t))):t.chars.length>0:t.chars.length?this.chars.some((e=>t.includes(e))):this.chars.length>0&&t.inverted)}intersect(t){if(this===t)return this;if(!this.inverted)return t.chars.length?new h(this.chars.filter((e=>t.includes(e))),!1):t.inverted?this:t;if(!t.inverted)return this.chars.length?new h(t.chars.filter((t=>this.includes(t))),!1):this.inverted?t:this;if(!this.chars.length||!t.chars.length)return this.chars.length?this:t;const e=new Set(this.chars);for(const s of t.chars)e.add(s);return new h([...e],!0)}union(t){if(this===t)return this;if(this.inverted)return t.chars.length?new h(this.chars.filter((e=>!t.includes(e))),!0):t.inverted?t:this;if(t.inverted)return this.chars.length?new h(t.chars.filter((t=>!this.includes(t))),!0):this.inverted?this:t;if(!this.chars.length||!t.chars.length)return this.chars.length?this:t;const e=new Set(this.chars);for(const s of t.chars)e.add(s);return new h([...e],!1)}rangeTo(t){if(!this.isSingular()||!t.isSingular())throw new Error("Cannot create range using existing ranges");return h.range(this.singularChar(),t.singularChar())}inverse(){return new h(this.chars,!this.inverted)}toGraph(t){return[{chars:this,advance:1,nexts:t}]}toString(){return this.chars.length?(this.chars.sort(),this.inverted?`[^${i(this.chars)}]`:1===this.chars.length?r(this.chars[0]):`[${i(this.chars)}]`):this.inverted?".":"[]"}}function a(){return this.map((t=>t.toString())).join("")}h.ANY=new h([],!0),h.NONE=new h([],!1),h.of=t=>new h([...t]),h.ofCode=t=>new h([String.fromCharCode(t)]),h.range=(t,e)=>{const s=t.charCodeAt(0),r=e.charCodeAt(0),n=[];for(let t=Math.min(s,r);t<=Math.max(s,r);++t)n.push(String.fromCharCode(t));return new h(n)},h.union=(...t)=>t.reduce(((t,e)=>t.union(e)),h.NONE),h.NUMERIC=h.range("0","9"),h.WORD=h.union(h.range("a","z"),h.range("A","Z"),h.NUMERIC,h.of("_")),h.NEWLINE=h.of(["\n","\r","\u2028","\u2029"]),h.SPACE=h.of([" ","\f","\n","\r","\t","\v","\xa0","\u1680","\u2028","\u2029","\u202f","\u205f","\u3000","\ufeff"]).union(h.range("\u2000","\u200a"));var o=(t,e=null)=>{let s=[...t];return s.length>0&&!(s[0]instanceof h)&&(s=s.map((t=>t===e?h.ANY:new h([t])))),Object.defineProperty(s,"toString",{value:a}),s};const l="0".charCodeAt(0);class c{constructor(t){this.data=t,this.pos=0,this.length=t.length}get(t=1){if(this.pos+t>this.length)throw new Error(`Incomplete token at ${this.pos} '${this.data}'`);return this.pos+=t,this.data.substr(this.pos-t,t)}check(t){const e=t.length;return!(this.pos+e>this.length)&&(this.data.substr(this.pos,e)===t&&(this.pos+=e,!0))}readUntil(t,e=!1){const s=this.pos,r=t.length;for(;this.pos+r<=this.length&&this.data.substr(this.pos,r)!==t;++this.pos);const n=this.pos;if(e&&!this.check(t))throw new Error(`Expected '${t}' after ${s} '${this.data}'`);return this.data.substring(s,n)}readInt(){let t=null;for(;this.pos<this.length;++this.pos){const e=this.data.charCodeAt(this.pos)-l;if(e<0||e>9)break;t=10*(t??0)+e}return t}end(){return this.pos>=this.length}}class u{constructor(t,e,s=null){this.mode=t,this.inverted=e,this.condition=s}toGraph(){throw new Error("Assertions are not currently supported")}}class d{constructor(t,e){this.chars=t,this.invChars=t.inverse(),this.inverted=e}toGraph(t){const e=[{advance:-1,nexts:t}];return this.inverted?[{advance:-1,nexts:[...this.chars.toGraph(this.chars.toGraph(e)),...this.invChars.toGraph(this.invChars.toGraph(e))]}]:[{advance:-1,nexts:[...this.chars.toGraph(this.invChars.toGraph(e)),...this.invChars.toGraph(this.chars.toGraph(e))]}]}}class p{constructor(t){this.pos=t}toGraph(t){return[{pos:this.pos,nexts:t}]}}p.BEGIN=new p(0),p.END=new p(-1);class f{constructor(t){this.ref=t}toGraph(t){return[...this.ref.toGraph(t),...t]}}class g{constructor(t,e,s,r=null){if(this.min=t,this.max=e,this.mode=s,this.target=r,null!==this.max&&this.max<this.min)throw new Error(`Invalid quantifier range: ${t} - ${e}`)}withTarget(t){return new g(this.min,this.max,this.mode,t)}toGraph(t){const e="lazy"===this.mode?e=>[...t,...e]:e=>[...e,...t];let s;if(null===this.max){const t={nexts:[]};t.nexts=this.target.toGraph(e([t])),s=[t];for(let t=this.min-1;t>0;--t)s=this.target.toGraph(s)}else{s=[];for(let t=this.max;t>0;--t)s=this.target.toGraph(t>=this.min?e(s):s)}return 0===this.min?e(s):s}}class m{constructor(t){this.elements=t}toGraph(t){let e=t;for(let t=this.elements.length;t-- >0;)e=this.elements[t].toGraph(e);return e}}class v{constructor(t){this.options=t}toGraph(t){const e=[];for(const s of this.options)e.push(...s.toGraph(t));return e}}class w{constructor(t,e){this.name=t,this.target=e}toGraph(t){return this.target.toGraph(t)}}const C=new class{constructor(t){this.advance=t}toGraph(t){return[{advance:this.advance,nexts:t}]}}(-1),E=Symbol(),D="A".charCodeAt(0),y=/^[0-9a-fA-F]+$/,b=t=>{if(!y.test(t))throw new Error(`Invalid hex value '${t}'`);return Number.parseInt(t,16)},x=new Map([["d",h.NUMERIC],["D",h.NUMERIC.inverse()],["w",h.WORD],["W",h.WORD.inverse()],["s",h.SPACE],["S",h.SPACE.inverse()],["t",h.of("\t")],["r",h.of("\r")],["n",h.of("\n")],["v",h.of("\v")],["f",h.of("\f")],["b",new d(h.WORD,!1)],["B",new d(h.WORD,!0)],["0",h.of("\0")],["c",t=>h.ofCode(1+t.get(1).charCodeAt(0)-D)],["x",t=>h.ofCode(b(t.get(2)))],["u",t=>{const e=t.check("{")?t.readUntil("}",!0):t.get(4);return h.ofCode(b(e))}],["\\",h.of("\\")],["k",(t,e)=>{if(!t.check("<"))throw new Error("Incomplete named backreference");const s=t.readUntil(">",!0),r=e.groupNames.get(s);if(!r)throw new Error(`Backreference to unknown group '${s}'`);return new f(r)}]]),M=new Map(x);M.set("b",h.of("\b")),M.delete("B"),M.delete("k");for(let t=1;t<10;++t)x.set(String(t),((e,s)=>{const r=s.groupNumbers[t-1];if(!r)throw new Error(`Backreference to unknown group ${t}`);return new f(r)}));function $(t,e,s,r){const n=t.get(s)??h.of(s);return"function"==typeof n?n(e,r):n}const N=t=>t.check("?")?"lazy":"greedy";function S(t){if(1===t.length)return t[0];const e=[];for(const s of t)s instanceof m?e.push(...s.elements):e.push(s);return new m(e)}function A(t){const e=[];let s=[];for(const r of t)if(r===E)e.push(S(s)),s=[];else if(r instanceof g){const t=s.pop();if(!t||t instanceof g)throw new Error("Invalid quantifier target");s.push(r.withTarget(t))}else s.push(r);return e.length?(e.push(S(s)),new v(e)):S(s)}const k=new Map([["\\",(t,e)=>$(x,t,t.get(),e)],["^",(t,e)=>e.begin],["$",(t,e)=>e.end],["|",E],[".",(t,e)=>e.any],["?",t=>new g(0,1,N(t))],["+",t=>new g(1,null,N(t))],["*",t=>new g(0,null,N(t))],["(",(t,e)=>{const s=(t=>{if(!t.check("?"))return{type:"capturing",name:null};if(t.check(":"))return{type:"inline"};if(t.check("="))return{type:"lookahead",inverted:!1};if(t.check("!"))return{type:"lookahead",inverted:!0};if(t.check("<="))return{type:"lookbehind",inverted:!1};if(t.check("<!"))return{type:"lookbehind",inverted:!0};if(t.check("<"))return{type:"capturing",name:t.readUntil(">",!0)};throw new Error(`Invalid group flags at ${t.pos}`)})(t),r=[];for(let s;")"!==(s=t.get());)r.push($(k,t,s,e));const n=A(r);switch(s.type){case"capturing":const t=new w(s.name,n);return e.groupNumbers.push(t),s.name&&e.groupNames.set(s.name,t),t;case"inline":return n;default:return new u(s.type,s.inverted,n)}}],["{",t=>{const e=t.readInt();if(null===e)throw new Error(`Invalid character in quantifier at ${t.pos}`);const s=t.check(",")?t.readInt():e;if(!t.check("}"))throw new Error(`Invalid character in quantifier at ${t.pos}`);return new g(e,s,N(t))}],["[",(t,e)=>{const s=t.check("^"),r=[];let n,i=!1;for(;"]"!==(n=t.get());)if("-"===n&&r.length>0)i=!0;else{let s="\\"===n?$(M,t,t.get(),e):h.of(n);i&&(i=!1,s=r.pop().rangeTo(s)),r.push(s)}if(i)throw new Error(`Incomplete character range at ${t.pos}`);const a=h.union(...r);return s?a.inverse():a}]]);function P(t,e,s){return(void 0===s.pos||e===(r=s.pos,n=t.length,(r%n+n)%n))&&!(s.chars&&!t[e].inputChars.intersects(s.chars));var r,n}class G{constructor(t,e=null){t instanceof RegExp||t instanceof G?(this.source=t.source,this.flags=e??t.flags):(this.source=String(t),this.flags=e??"");const s=function(t){return{hasIndices:t.includes("d"),global:t.includes("g"),ignoreCase:t.includes("i"),multiline:t.includes("m"),dotAll:t.includes("s"),unicode:t.includes("u"),sticky:t.includes("y")}}(this.flags);Object.assign(this,s);const r=function(t,e){const s={flags:e,any:e.dotAll?h.ANY:h.NEWLINE.inverse(),begin:e.multiline?new v([new m([C,h.NEWLINE]),p.BEGIN]):p.BEGIN,end:e.multiline?new v([new m([h.NEWLINE,C]),p.END]):p.END,groupNumbers:[],groupNames:new Map},r=[];for(const e=new c(t);!e.end();)r.push($(k,e,e.get(),s));return A(r)}(this.source,s);this.endNode={nexts:[]},this.beginNodes=r.toGraph([this.endNode]),this.graphContainsLoops=!0,this.graphContainsOverwrites=function(t,e,s=null){const r=new Set,n=[t];let i=s;for(;n.length;){const t=n.pop();i=e(t,i);for(const e of t.nexts)r.has(e)||(n.push(e),r.add(e))}return i}({nexts:this.beginNodes},((t,e)=>e||t.advance<0),!1)}reverse(t,e=null){const s=o(t,e),r=this.graphContainsLoops&&this.graphContainsOverwrites,{beginState:n,endState:i}=function(t,e,s,r){const n=t.length,i=[...t,h.NONE].map((t=>({inputChars:t,states:new Map}))),a={pos:-1,prevs:[],nexts:e,nextPos:0,node:null,remaining:0,history:r?new Set:null,solution:null};let o=[a];for(;o.length;){const t=[];for(const e of o){const s=e.nextPos;if(s<0||s>n)continue;const{states:h}=i[s];for(const n of e.nexts){const a=h.get(n);if(a)if(r){if(!e.history.has(a)){a.prevs.push(e);for(const t of e.history)a.history.add(t)}}else a.prevs.push(e);else if(P(i,s,n)){const i={pos:s,prevs:[e],nexts:n.nexts,nextPos:s+(n.advance??0),node:n,remaining:0,history:r?new Set(e.history):null,solution:null};i.history?.add(i),h.set(n,i),t.push(i)}}}o=t}return{beginState:a,endState:i[n].states.get(s)}}(s,this.beginNodes,this.endNode,r);if(!i)return null;const a=this.graphContainsOverwrites?function(t,e,s){const r=t.length,n=[s];for(;n.length;){const t=n.pop();for(const e of t.prevs)1==++e.remaining&&n.push(e)}for(s.solution=t,n.push(s);n.length;){const t=n.pop();if(t.solution&&t.node?.chars){const e=t.solution[t.pos].intersect(t.node.chars);e.isEmpty()?t.solution=null:t.solution[t.pos]=e}for(const e of t.prevs){if(t.solution)if(e.solution)for(let s=0;s<r;++s)e.solution[s]=e.solution[s].union(t.solution[s]);else e.solution=[...t.solution];0==--e.remaining&&n.push(e)}}return e.solution}(s,n,i):function(t,e,s){const r=t.map((()=>h.NONE)),n=[s];for(;n.length;){const t=n.pop();t.node?.chars&&(r[t.pos]=r[t.pos].union(t.node.chars));for(const e of t.prevs)1==++e.remaining&&n.push(e)}return r.map(((e,s)=>t[s].intersect(e)))}(s,0,i);return a?o(a):null}test(t,e=null){return null!==this.reverse(t,e)}toString(){return this.pattern}}G.compile=(t,e)=>new G(t,e),G.CharacterClass=h,G.string=o;function I(t){return document.getElementById(t)}function R(t,e){return t.querySelector(`[name="${e}"]`)}function O(t){return t.replace(/\u0000/g,"\u2400").replace(/\u0001/g,"\u2401").replace(/\u0002/g,"\u2402").replace(/\u0003/g,"\u2403").replace(/\u0004/g,"\u2404").replace(/\u0005/g,"\u2405").replace(/\u0006/g,"\u2406").replace(/\u0007/g,"\u2407").replace(/\u0008/g,"\u2408").replace(/\u0009/g,"\u2409").replace(/\u000A/g,"\u240a").replace(/\u000B/g,"\u240b").replace(/\u000C/g,"\u240c").replace(/\u000D/g,"\u240d").replace(/\u000E/g,"\u240e").replace(/\u000F/g,"\u240f").replace(/\u0010/g,"\u2410").replace(/\u0011/g,"\u2411").replace(/\u0012/g,"\u2412").replace(/\u0013/g,"\u2413").replace(/\u0014/g,"\u2414").replace(/\u0015/g,"\u2415").replace(/\u0016/g,"\u2416").replace(/\u0017/g,"\u2417").replace(/\u0018/g,"\u2418").replace(/\u0019/g,"\u2419").replace(/\u001A/g,"\u241a").replace(/\u001B/g,"\u241b").replace(/\u001C/g,"\u241c").replace(/\u001D/g,"\u241d").replace(/\u001E/g,"\u241e").replace(/\u001F/g,"\u241f").replace(/\s/g,"\u2420")}function L(t){t.preventDefault()}class B{constructor(t,e){this.form=t,this.patternCache=e,this.debounce=-1,this.refresh=this.refresh.bind(this),this.debouncedRefresh=this.debouncedRefresh.bind(this)}init(){this.form.addEventListener("submit",L),this.form.addEventListener("input",this.debouncedRefresh),this.refresh()}debouncedRefresh(){window.clearTimeout(this.debounce),this.debounce=window.setTimeout(this.refresh,0)}}function z(t){return t.every((t=>t.isSingular()))}function q(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!t[s].equals(e[s]))return!1;return!0}class W extends B{constructor(t,e,s,r){super(t,e),this.dimensions=s,this.grid=r,this.eError=this.form.querySelector(".error"),this.eDims=s.map((t=>R(this.form,`${t}s`)))}init(){super.init(),this.dimensions.forEach(((t,e)=>{R(this.form,`add-${t}`).addEventListener("click",this.addDim.bind(this,e)),R(this.form,`remove-${t}`).addEventListener("click",this.removeDim.bind(this,e))}))}refresh(){this.grid.resize(this.dimensions.map(((t,e)=>this.getDim(e))));const t=this.grid.getBlankData(),e=this.grid.getClues();try{const s=function(t,e){let s=t;for(;;){const t=[...s];for(const{name:s,pattern:r,indices:n}of e){const e=r.reverse(n.map((e=>t[e])));if(!e)throw new Error(`Failed to match ${s}`);n.forEach(((s,r)=>{t[s]=e[r]}))}if(z(t)||q(s,t))return t;s=t}}(t,e.map((({name:t,pattern:e,indices:s})=>{try{return{name:t,pattern:this.patternCache.get(e),indices:s}}catch(e){throw new Error(`${e} in ${t}`)}})));this.grid.setData(s),this.error=null}catch(t){this.grid.clearData(),this.error=String(t)}}addDim(t){this.setDim(t,this.getDim(t)+1),this.refresh()}removeDim(t){const e=this.getDim(t);e>1&&(this.setDim(t,e-1),this.refresh())}getDim(t){return Number.parseInt(this.eDims[t].value,10)}setDim(t,e){this.eDims[t].value=String(e)}set error(t){null!==t?this.form.classList.add("fail"):this.form.classList.remove("fail"),this.eError.innerText=null!=t?t:""}}class T{constructor(t){this.container=t,this.patternRows=[],this.patternCols=[],this.patternAltRows=[],this.patternAltCols=[],this.cells=[],this.isDouble=!1}getBlankData(){const t=[];return this.cells.forEach((e=>e.forEach((()=>t.push(G.CharacterClass.ANY))))),t}clearData(){this.cells.forEach((t=>t.forEach((t=>{t.eCell.classList.remove("solved"),t.value=""}))))}setData(t){const e=this.patternCols.length;this.cells.forEach(((s,r)=>s.forEach(((s,n)=>{const i=t[r*e+n];i.isSingular()?(s.eCell.classList.add("solved"),s.value=O(i.singularChar())):(s.eCell.classList.remove("solved"),s.value=String(i))}))))}getClues(){const t=this.patternRows.length,e=this.patternCols.length,s=[];for(let r=0;r<t;++r){const t=[];for(let s=0;s<e;++s)t.push(r*e+s);s.push({name:`row ${r+1}`,pattern:this.patternRows[r].pattern,indices:t}),this.isDouble&&s.push({name:`alt row ${r+1}`,pattern:this.patternAltRows[r].pattern,indices:t})}for(let r=0;r<e;++r){const n=[];for(let s=0;s<t;++s)n.push(s*e+r);s.push({name:`column ${r+1}`,pattern:this.patternCols[r].pattern,indices:n}),this.isDouble&&s.push({name:`alt column ${r+1}`,pattern:this.patternAltCols[r].pattern,indices:n})}return s}updateDouble(t){t!==this.isDouble&&(this.removeDOM(),this.isDouble=t,this.addDOM())}resize([t,e]){const s=this.patternRows.length,r=this.patternCols.length;if(t!==s||e!==r){this.removeDOM();for(let e=s;e<t;++e)this.cells.push([]),this.patternRows.push(new U("row",e)),this.patternAltRows.push(new U("altrow",e));for(let t=r;t<e;++t)this.patternCols.push(new U("col",t)),this.patternAltCols.push(new U("altcol",t));for(let s=0;s<t;++s){const t=this.cells[s];for(let r=t.length;r<e;++r)t.push(new _(s,r));t.length=e}this.patternRows.length=t,this.patternCols.length=e,this.patternAltRows.length=t,this.patternAltCols.length=e,this.cells.length=t,this.addDOM()}}removeDOM(){[...this.patternRows,...this.patternCols].forEach((t=>this.container.removeChild(t.ePattern))),this.isDouble&&[...this.patternAltRows,...this.patternAltCols].forEach((t=>this.container.removeChild(t.ePattern))),this.cells.forEach((t=>t.forEach((t=>this.container.removeChild(t.eCell)))))}addDOM(){const t=this.patternRows.length,e=this.patternCols.length;this.patternCols.forEach((t=>this.container.appendChild(t.ePattern)));for(let e=0;e<t;++e)this.container.appendChild(this.patternRows[e].ePattern),this.cells[e].forEach((t=>this.container.appendChild(t.eCell))),this.isDouble&&this.container.appendChild(this.patternAltRows[e].ePattern);this.isDouble&&this.patternAltCols.forEach((t=>this.container.appendChild(t.ePattern))),this.container.style.width=`calc(var(--w) * ${e})`,this.container.style.height=`calc(var(--h) * ${t})`}}class U{constructor(t,e){this.ePattern=document.createElement("input"),this.ePattern.setAttribute("type","text"),this.ePattern.setAttribute("name",`pattern_${t}_${e}`),"col"===t||"altcol"===t?this.ePattern.style.left=`calc(var(--w) * ${e})`:this.ePattern.style.top=`calc(var(--h) * ${e})`,this.ePattern.className=`pattern ${t}`,this.ePattern.value=".*"}get pattern(){return this.ePattern.value}}class _{constructor(t,e){this.eCell=document.createElement("output"),this.eCell.setAttribute("name",`out_${t}_${e}`),this.eCell.className="cell",this.eCell.style.top=`calc(var(--h) * ${t})`,this.eCell.style.left=`calc(var(--w) * ${e})`}set value(t){this.eCell.value=t||" "}}function Y(t,e){t.style.top=e.top,t.style.left=e.left}class j{constructor(t){this.container=t,this.d1=-1,this.d2=-1,this.d3=-1,this.patterns1=[],this.patterns2=[],this.patterns3=[],this.cells=[],this.corners=[]}corner(t){return this.corners[t-1]}getBlankData(){return this.cells.map((()=>G.CharacterClass.ANY))}clearData(){this.cells.forEach((t=>{t.eCell.classList.remove("solved"),t.value=""}))}setData(t){this.cells.forEach(((e,s)=>{const r=t[s];r.isSingular()?(e.eCell.classList.add("solved"),e.value=O(r.singularChar())):(e.eCell.classList.remove("solved"),e.value=String(r))}))}getClues(){const{d1:t,d2:e,d3:s}=this,r=this.patterns1.map(((t,e)=>({name:`\u2199 ${e+1}`,pattern:t.pattern,indices:[]}))),n=this.patterns2.map(((t,e)=>({name:`\u2192 ${e+1}`,pattern:t.pattern,indices:[]}))),i=this.patterns3.map(((t,e)=>({name:`\u2196 ${e+1}`,pattern:t.pattern,indices:[]})));let h=0;for(let a=0;a<t+s-1;++a){const o=Math.max(0,a-(t-1)),l=Math.min(a+e,e+s-1);for(let e=o;e<l;++e){const s=a,o=e-a+(t-1);r[this.patterns1.length-e-1].indices.push(h),n[s].indices.push(h),i[o].indices.unshift(h),++h}}return[...r,...n,...i]}resize([t,e,s]){if(t===this.d1&&e===this.d2&&s===this.d3)return;this.removeDOM(),this.patterns1.length=0,this.patterns2.length=0,this.patterns3.length=0,this.cells.length=0;const{D1:r,D2:n,D3:i}=j,h=new F(0,t-1),a=h.addMult(r,t-1),o=a.addMult(n,e-1),l=o.addMult(i,s-1),c=l.addMult(r,-(t-1)),u=c.addMult(n,-(e-1));this.corners=[h,a,o,l,c,u];for(let e=0;e<t;++e)this.patterns2.push(new Z("d2",a.addMult(r,-e).addMult(n,-1)));for(let t=1;t<s;++t)this.patterns2.push(new Z("d2",h.addMult(i,t).addMult(n,-1)));for(let t=0;t<e;++t)this.patterns3.push(new Z("d3",u.addMult(n,t).addMult(i,1)));for(let e=1;e<t;++e)this.patterns3.push(new Z("d3",c.addMult(r,e).addMult(i,1)));for(let t=0;t<s;++t)this.patterns1.push(new Z("d1",l.addMult(i,-t).addMult(r,1)));for(let t=1;t<e;++t)this.patterns1.push(new Z("d1",o.addMult(n,-t).addMult(r,1)));for(let i=0;i<t+s-1;++i){const h=a.addMult(r,-i),o=Math.max(0,i-(t-1)),l=Math.min(i+e,e+s-1);for(let t=o;t<l;++t)this.cells.push(new H(h.addMult(n,t)))}this.d1=t,this.d2=e,this.d3=s,this.addDOM()}removeDOM(){[...this.patterns2,...this.patterns3,...this.patterns1].forEach((t=>this.container.removeChild(t.ePattern))),this.cells.forEach((t=>this.container.removeChild(t.eCell)))}addDOM(){[...this.patterns2,...this.patterns3,...this.patterns1].forEach((t=>this.container.appendChild(t.ePattern))),this.cells.forEach((t=>this.container.appendChild(t.eCell))),this.container.style.width=`calc(var(--sx) * ${.5*this.d1+this.d2+.5*this.d3-2})`,this.container.style.height=`calc(var(--sy) * ${this.d1+this.d3-2})`}}j.D1={x:.5,y:-1},j.D2={x:1,y:0},j.D3={x:.5,y:1};class F{constructor(t,e){this.x=t,this.y=e}addMult(t,e){return new F(this.x+t.x*e,this.y+t.y*e)}get left(){return`calc(var(--sx) * ${this.x})`}get top(){return`calc(var(--sy) * ${this.y})`}}class Z{constructor(t,e){this.ePattern=document.createElement("input"),this.ePattern.setAttribute("type","text"),Y(this.ePattern,e),this.ePattern.className=`pattern ${t}`,this.ePattern.value=".*"}get pattern(){return this.ePattern.value}}class H{constructor(t){this.eCell=document.createElement("output"),this.eCell.className="cell",Y(this.eCell,t)}set value(t){this.eCell.value=t||" "}}const J=new class{constructor(t,e){this.generator=t,this.maxSize=e,this.cache=new Map}get(t){if(this.maxSize<=0)return this.generator(t);const e=this.cache.get(t);if(e)return this.cache.delete(t),this.cache.set(t,e),e;const s=this.generator(t);return this.cache.set(t,s),this.cache.size>this.maxSize&&this.cache.delete(this.cache.keys().next().value),s}}((t=>G.compile(t,"s")),100);new class extends B{constructor(){super(...arguments),this.ePattern=R(this.form,"pattern"),this.eInput=R(this.form,"input"),this.eOutput=R(this.form,"output"),this.eError=this.form.querySelector(".error")}refresh(){try{const t=this.patternCache.get(this.pattern).reverse(this.input,"?");null===t?(this.output="",this.error="No match"):(this.output=O(String(t)),this.error=null)}catch(t){this.output="",this.error=String(t)}}get pattern(){return this.ePattern.value}get input(){return this.eInput.value}set output(t){this.eOutput.value=t||" "}set error(t){null!==t?this.form.classList.add("fail"):this.form.classList.remove("fail"),this.eError.innerText=null!=t?t:""}}(I("form-single"),J).init(),new class extends W{constructor(t,e){super(t,e,["row","col"],new T(t.querySelector(".grid"))),this.eDouble=R(this.form,"double")}refresh(){this.grid.updateDouble(this.eDouble.checked),super.refresh()}}(I("form-rect"),J).init(),new class extends W{constructor(t,e){super(t,e,["d1","d2","d3"],new j(t.querySelector(".grid")))}refresh(){super.refresh(),Y(R(this.form,"add-d1"),this.grid.corner(6).addMult(j.D1,-1.7)),Y(R(this.form,"remove-d1"),this.grid.corner(6).addMult(j.D1,-1)),Y(R(this.form,"add-d2"),this.grid.corner(4).addMult(j.D2,1.7)),Y(R(this.form,"remove-d2"),this.grid.corner(4).addMult(j.D2,1)),Y(R(this.form,"add-d3"),this.grid.corner(2).addMult(j.D3,-1.7)),Y(R(this.form,"remove-d3"),this.grid.corner(2).addMult(j.D3,-1))}}(I("form-hex"),J).init(),document.body.removeChild(I("loading"))}();
